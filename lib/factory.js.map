{
    "version": 3,
    "file": "factory.js",
    "sourceRoot": "",
    "sources": [
        "/src/factory.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport qs from 'qs';\nimport {RendererStore, IRendererStore, IIRendererStore} from './store/index';\nimport {getEnv, destroy} from 'mobx-state-tree';\nimport {wrapFetcher} from './utils/api';\nimport {normalizeLink} from './utils/normalizeLink';\nimport {findIndex, promisify} from './utils/helper';\nimport {Api, fetcherResult, Payload, SchemaNode, Schema, Action} from './types';\nimport {observer} from 'mobx-react';\nimport Scoped from './Scoped';\nimport {getTheme, ThemeInstance, ThemeProps} from './theme';\nimport find from 'lodash/find';\nimport Alert from './components/Alert2';\nimport {toast} from './components/Toast';\nimport {alert, confirm, setRenderSchemaFn} from './components/Alert';\nimport {getDefaultLocale, makeTranslator, LocaleProps} from './locale';\nimport ScopedRootRenderer, {RootRenderProps} from './Root';\nimport {HocStoreFactory} from './WithStore';\nimport {EnvContext, RendererEnv} from './env';\n\nexport interface TestFunc {\n  (\n    path: string,\n    schema?: Schema,\n    resolveRenderer?: (\n      path: string,\n      schema?: Schema,\n      props?: any\n    ) => null | RendererConfig\n  ): boolean;\n}\n\nexport interface RendererBasicConfig {\n  test: RegExp | TestFunc;\n  name?: string;\n  storeType?: string;\n  shouldSyncSuperStore?: (\n    store: any,\n    props: any,\n    prevProps: any\n  ) => boolean | undefined;\n  storeExtendsData?: boolean; // 是否需要继承上层数据。\n  weight?: number; // 权重，值越低越优先命中。\n  isolateScope?: boolean;\n  isFormItem?: boolean;\n  // [propName:string]:any;\n}\n\nexport interface RendererProps extends ThemeProps, LocaleProps {\n  render: (region: string, node: SchemaNode, props?: any) => JSX.Element;\n  env: RendererEnv;\n  $path: string; // 当前组件所在的层级信息\n  store?: IIRendererStore;\n  syncSuperStore?: boolean;\n  data: {\n    [propName: string]: any;\n  };\n  defaultData?: object;\n  className?: any;\n  [propName: string]: any;\n}\n\nexport type RendererComponent = React.ComponentType<RendererProps> & {\n  propsList?: Array<any>;\n};\n\nexport interface RendererConfig extends RendererBasicConfig {\n  component: RendererComponent;\n  Renderer?: RendererComponent; // 原始组件\n}\n\nexport interface RenderSchemaFilter {\n  (schema: Schema, renderer: RendererConfig, props?: any): Schema;\n}\n\nexport interface RenderOptions {\n  session?: string;\n  fetcher?: (config: fetcherConfig) => Promise<fetcherResult>;\n  wsFetcher?: (\n    ws: string,\n    onMessage: (data: any) => void,\n    onError: (error: any) => void\n  ) => void;\n  isCancel?: (value: any) => boolean;\n  notify?: (\n    type: 'error' | 'success',\n    msg: string,\n    conf?: {\n      closeButton?: boolean;\n      timeout?: number;\n    }\n  ) => void;\n  jumpTo?: (to: string, action?: Action, ctx?: object) => void;\n  alert?: (msg: string) => void;\n  confirm?: (msg: string, title?: string) => boolean | Promise<boolean>;\n  rendererResolver?: (\n    path: string,\n    schema: Schema,\n    props: any\n  ) => null | RendererConfig;\n  copy?: (contents: string) => void;\n  getModalContainer?: () => HTMLElement;\n  loadRenderer?: (\n    schema: Schema,\n    path: string,\n    reRender: Function\n  ) => Promise<React.ReactType> | React.ReactType | JSX.Element | void;\n  affixOffsetTop?: number;\n  affixOffsetBottom?: number;\n  richTextToken?: string;\n  [propName: string]: any;\n}\n\nexport interface fetcherConfig {\n  url: string;\n  method?: 'get' | 'post' | 'put' | 'patch' | 'delete';\n  data?: any;\n  config?: any;\n}\n\nconst renderers: Array<RendererConfig> = [];\nconst rendererNames: Array<string> = [];\nconst schemaFilters: Array<RenderSchemaFilter> = [];\nlet anonymousIndex = 1;\n\nexport function addSchemaFilter(fn: RenderSchemaFilter) {\n  schemaFilters.push(fn);\n}\n\nexport function filterSchema(\n  schema: Schema,\n  render: RendererConfig,\n  props?: any\n) {\n  return schemaFilters.reduce(\n    (schema, filter) => filter(schema, render, props),\n    schema\n  ) as Schema;\n}\n\nexport function Renderer(config: RendererBasicConfig) {\n  return function <T extends RendererComponent>(component: T): T {\n    const renderer = registerRenderer({\n      ...config,\n      component: component\n    });\n    return renderer.component as T;\n  };\n}\n\nexport function registerRenderer(config: RendererConfig): RendererConfig {\n  if (!config.test) {\n    throw new TypeError('config.test is required');\n  } else if (!config.component) {\n    throw new TypeError('config.component is required');\n  }\n\n  config.weight = config.weight || 0;\n  config.Renderer = config.component;\n  config.name = config.name || `anonymous-${anonymousIndex++}`;\n\n  if (~rendererNames.indexOf(config.name)) {\n    throw new Error(\n      `The renderer with name \"${config.name}\" has already exists, please try another name!`\n    );\n  }\n\n  if (config.storeType && config.component) {\n    config.component = HocStoreFactory({\n      storeType: config.storeType,\n      extendsData: config.storeExtendsData,\n      shouldSyncSuperStore: config.shouldSyncSuperStore\n    })(observer(config.component));\n  }\n\n  if (config.isolateScope) {\n    config.component = Scoped(config.component);\n  }\n\n  const idx = findIndex(\n    renderers,\n    item => (config.weight as number) < item.weight\n  );\n  ~idx ? renderers.splice(idx, 0, config) : renderers.push(config);\n  rendererNames.push(config.name);\n  return config;\n}\n\nexport function unRegisterRenderer(config: RendererConfig | string) {\n  let idx =\n    typeof config === 'string'\n      ? findIndex(renderers, item => item.name === config)\n      : renderers.indexOf(config);\n  ~idx && renderers.splice(idx, 1);\n\n  let idx2 =\n    typeof config === 'string'\n      ? findIndex(rendererNames, item => item === config)\n      : rendererNames.indexOf(config.name || '');\n  ~idx2 && rendererNames.splice(idx2, 1);\n\n  // 清空渲染器定位缓存\n  cache = {};\n}\n\nexport function loadRenderer(schema: Schema, path: string) {\n  return (\n    <Alert level=\"danger\">\n      <p>Error: 找不到对应的渲染器</p>\n      <p>Path: {path}</p>\n      <pre>\n        <code>{JSON.stringify(schema, null, 2)}</code>\n      </pre>\n    </Alert>\n  );\n}\n\nconst defaultOptions: RenderOptions = {\n  session: 'global',\n  affixOffsetTop: 50,\n  affixOffsetBottom: 0,\n  richTextToken: '',\n  loadRenderer,\n  fetcher() {\n    return Promise.reject('fetcher is required');\n  },\n  // 使用 WebSocket 来实时获取数据\n  wsFetcher(ws, onMessage, onError) {\n    if (ws) {\n      const socket = new WebSocket(ws);\n      socket.onmessage = (event: any) => {\n        if (event.data) {\n          onMessage(JSON.parse(event.data));\n        }\n      };\n      socket.onerror = onError;\n      return {\n        close: socket.close\n      };\n    } else {\n      return {\n        close: () => {}\n      };\n    }\n  },\n  isCancel() {\n    console.error(\n      'Please implements this. see https://baidu.gitee.io/amis/docs/start/getting-started#%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97'\n    );\n    return false;\n  },\n  updateLocation() {\n    console.error(\n      'Please implements this. see https://baidu.gitee.io/amis/docs/start/getting-started#%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97'\n    );\n  },\n  alert,\n  confirm,\n  notify: (type, msg, conf) =>\n    toast[type]\n      ? toast[type](msg, type === 'error' ? 'Error' : 'Info', conf)\n      : console.warn('[Notify]', type, msg),\n\n  jumpTo: (to: string, action?: any) => {\n    if (to === 'goBack') {\n      return window.history.back();\n    }\n    to = normalizeLink(to);\n    if (action && action.actionType === 'url') {\n      action.blank === false ? (window.location.href = to) : window.open(to);\n      return;\n    }\n    if (/^https?:\\/\\//.test(to)) {\n      window.location.replace(to);\n    } else {\n      location.href = to;\n    }\n  },\n  isCurrentUrl: (to: string) => {\n    if (!to) {\n      return false;\n    }\n\n    const link = normalizeLink(to);\n    const location = window.location;\n    let pathname = link;\n    let search = '';\n    const idx = link.indexOf('?');\n    if (~idx) {\n      pathname = link.substring(0, idx);\n      search = link.substring(idx);\n    }\n    if (search) {\n      if (pathname !== location.pathname || !location.search) {\n        return false;\n      }\n      const query = qs.parse(search.substring(1));\n      const currentQuery = qs.parse(location.search.substring(1));\n      return Object.keys(query).every(key => query[key] === currentQuery[key]);\n    } else if (pathname === location.pathname) {\n      return true;\n    }\n    return false;\n  },\n  copy(contents: string) {\n    console.error('copy contents', contents);\n  },\n  rendererResolver: resolveRenderer\n};\nlet stores: {\n  [propName: string]: IRendererStore;\n} = {};\nexport function render(\n  schema: Schema,\n  props: RootRenderProps = {},\n  options: RenderOptions = {},\n  pathPrefix: string = ''\n): JSX.Element {\n  let locale = props.locale || getDefaultLocale();\n  // 兼容 locale 的不同写法\n  locale = locale.replace('_', '-');\n  locale = locale === 'en' ? 'en-US' : locale;\n  locale = locale === 'zh' ? 'zh-CN' : locale;\n  locale = locale === 'cn' ? 'zh-CN' : locale;\n  const translate = props.translate || makeTranslator(locale);\n  let store = stores[options.session || 'global'];\n\n  if (!store) {\n    options = {\n      ...defaultOptions,\n      ...options,\n      fetcher: options.fetcher\n        ? wrapFetcher(options.fetcher)\n        : defaultOptions.fetcher,\n      confirm: promisify(\n        options.confirm || defaultOptions.confirm || window.confirm\n      ),\n      locale,\n      translate\n    } as any;\n\n    store = RendererStore.create({}, options);\n    stores[options.session || 'global'] = store;\n  }\n\n  (window as any).amisStore = store; // 为了方便 debug.\n  const env = getEnv(store);\n\n  const theme = props.theme || options.theme || 'default';\n  env.theme = getTheme(theme);\n\n  if (props.locale !== undefined) {\n    env.translate = translate;\n    env.locale = locale;\n  }\n\n  return (\n    <EnvContext.Provider value={env}>\n      <ScopedRootRenderer\n        {...props}\n        schema={schema}\n        pathPrefix={pathPrefix}\n        rootStore={store}\n        env={env}\n        theme={theme}\n        locale={locale}\n        translate={translate}\n      />\n    </EnvContext.Provider>\n  );\n}\n\n// 默认 env 会被缓存，所以新传入的 env 不会替换旧的。\n// 除非先删了旧的，新的才会生效。\nexport function clearStoresCache(\n  sessions: Array<string> | string = Object.keys(stores)\n) {\n  if (!Array.isArray(sessions)) {\n    sessions = [sessions];\n  }\n\n  sessions.forEach(key => {\n    const store = stores[key];\n\n    // @ts-ignore\n    delete stores[key];\n\n    store && destroy(store);\n  });\n}\n\n// 当然也可以直接这样更新。\n// 主要是有时候第一次创建的时候并没有准备多少接口，\n// 可以后续补充点，比如 amis 自己实现的，prompt 里面的表单。\nexport function updateEnv(options: Partial<RenderOptions>, session = 'global') {\n  options = {\n    ...options\n  };\n\n  if (options.fetcher) {\n    options.fetcher = wrapFetcher(options.fetcher) as any;\n  }\n\n  if (options.confirm) {\n    options.confirm = promisify(options.confirm);\n  }\n\n  let store = stores[options.session || session];\n  if (!store) {\n    store = RendererStore.create({}, options);\n    stores[options.session || session] = store;\n  } else {\n    const env = getEnv(store);\n    Object.assign(env, options);\n  }\n}\n\nlet cache: {[propName: string]: RendererConfig} = {};\nexport function resolveRenderer(\n  path: string,\n  schema?: Schema\n): null | RendererConfig {\n  if (cache[path]) {\n    return cache[path];\n  } else if (path && path.length > 1024) {\n    throw new Error('Path太长是不是死循环了？');\n  }\n\n  let renderer: null | RendererConfig = null;\n\n  renderers.some(item => {\n    let matched = false;\n\n    // 不应该搞得这么复杂的，让每个渲染器唯一 id，自己不晕别人用起来也不晕。\n    if (typeof item.test === 'function') {\n      matched = item.test(path, schema, resolveRenderer);\n    } else if (item.test instanceof RegExp) {\n      matched = item.test.test(path);\n    }\n\n    if (matched) {\n      renderer = item;\n    }\n\n    return matched;\n  });\n\n  // 只能缓存纯正则表达式的后者方法中没有用到第二个参数的，\n  // 因为自定义 test 函数的有可能依赖 schema 的结果\n  if (\n    renderer !== null &&\n    ((renderer as RendererConfig).test instanceof RegExp ||\n      (typeof (renderer as RendererConfig).test === 'function' &&\n        ((renderer as RendererConfig).test as Function).length < 2))\n  ) {\n    cache[path] = renderer;\n  }\n\n  return renderer;\n}\n\nexport function getRenderers() {\n  return renderers.concat();\n}\n\nexport function getRendererByName(name: string) {\n  return find(renderers, item => item.name === name);\n}\n\nsetRenderSchemaFn((controls, value, callback, scopeRef, theme) => {\n  return render(\n    {\n      name: 'form',\n      type: 'form',\n      wrapWithPanel: false,\n      mode: 'horizontal',\n      controls,\n      messages: {\n        validateFailed: ''\n      }\n    },\n    {\n      data: value,\n      onFinished: callback,\n      scopeRef,\n      theme\n    },\n    {\n      session: 'prompt'\n    }\n  );\n});\n\nexport {RendererEnv};\n"
    ]
}