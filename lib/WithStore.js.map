{
    "version": 3,
    "file": "WithStore.js",
    "sourceRoot": "",
    "sources": [
        "/src/WithStore.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import hoistNonReactStatic from 'hoist-non-react-statics';\nimport {observer} from 'mobx-react';\nimport React from 'react';\nimport {RendererProps} from './factory';\nimport {IIRendererStore, IRendererStore} from './store';\nimport {RendererData, SchemaNode} from './types';\nimport getExprProperties from './utils/filter-schema';\nimport {\n  createObject,\n  extendObject,\n  guid,\n  isObjectShallowModified,\n  syncDataFromSuper\n} from './utils/helper';\nimport {RootStoreContext} from './WithRootStore';\n\nexport function HocStoreFactory(renderer: {\n  storeType: string;\n  extendsData?: boolean;\n  shouldSyncSuperStore?: (\n    store: any,\n    props: any,\n    prevProps: any\n  ) => boolean | undefined;\n}): any {\n  return function <T extends React.ComponentType<RendererProps>>(Component: T) {\n    type Props = Omit<\n      RendererProps,\n      'store' | 'data' | 'dataUpdatedAt' | 'scope'\n    > & {\n      store?: IIRendererStore;\n      data?: RendererData;\n      scope?: RendererData;\n    };\n\n    @observer\n    class StoreFactory extends React.Component<Props> {\n      static displayName = `WithStore(${\n        Component.displayName || Component.name\n      })`;\n      static ComposedComponent = Component;\n      static contextType = RootStoreContext;\n      store: IIRendererStore;\n      context!: React.ContextType<typeof RootStoreContext>;\n      ref: any;\n\n      getWrappedInstance() {\n        return this.ref;\n      }\n\n      refFn(ref: any) {\n        this.ref = ref;\n      }\n\n      formatData(data: any): object {\n        if (Array.isArray(data)) {\n          return {\n            items: data\n          };\n        }\n\n        return data as object;\n      }\n\n      componentWillMount() {\n        const rootStore = this.context;\n        this.renderChild = this.renderChild.bind(this);\n        this.refFn = this.refFn.bind(this);\n\n        const store = rootStore.addStore({\n          id: guid(),\n          path: this.props.$path,\n          storeType: renderer.storeType,\n          parentId: this.props.store ? this.props.store.id : ''\n        }) as IIRendererStore;\n        this.store = store;\n\n        if (renderer.extendsData === false) {\n          store.initData(\n            createObject(\n              (this.props.data as any)\n                ? (this.props.data as any).__super\n                : null,\n              {\n                ...this.formatData(this.props.defaultData),\n                ...this.formatData(this.props.data)\n              }\n            )\n          );\n        } else if (\n          this.props.scope ||\n          (this.props.data && (this.props.data as any).__super)\n        ) {\n          if (this.props.store && this.props.data === this.props.store.data) {\n            store.initData(\n              createObject(this.props.store.data, {\n                ...this.formatData(this.props.defaultData)\n              })\n            );\n          } else {\n            store.initData(\n              createObject(\n                (this.props.data as any).__super || this.props.scope,\n                {\n                  ...this.formatData(this.props.defaultData),\n                  ...this.formatData(this.props.data)\n                }\n              )\n            );\n          }\n        } else {\n          store.initData({\n            ...this.formatData(this.props.defaultData),\n            ...this.formatData(this.props.data)\n          });\n        }\n      }\n\n      componentWillReceiveProps(nextProps: RendererProps) {\n        const props = this.props;\n        const store = this.store;\n        const shouldSync = renderer.shouldSyncSuperStore?.(\n          store,\n          nextProps,\n          props\n        );\n\n        if (shouldSync === false) {\n          return;\n        }\n\n        if (renderer.extendsData === false) {\n          if (\n            shouldSync === true ||\n            props.defaultData !== nextProps.defaultData ||\n            isObjectShallowModified(props.data, nextProps.data) ||\n            //\n            // 特殊处理 CRUD。\n            // CRUD 中 toolbar 里面的 data 是空对象，但是 __super 会不一样\n            (nextProps.data &&\n              props.data &&\n              nextProps.data.__super !== props.data.__super)\n          ) {\n            store.initData(\n              extendObject(nextProps.data, {\n                ...(store.hasRemoteData ? store.data : null), // todo 只保留 remote 数据\n                ...this.formatData(nextProps.defaultData),\n                ...this.formatData(nextProps.data)\n              })\n            );\n          }\n        } else if (\n          shouldSync === true ||\n          isObjectShallowModified(props.data, nextProps.data)\n        ) {\n          if (nextProps.store && nextProps.store.data === nextProps.data) {\n            store.initData(\n              createObject(\n                nextProps.store.data,\n                nextProps.syncSuperStore === false\n                  ? {\n                      ...store.data\n                    }\n                  : syncDataFromSuper(\n                      store.data,\n                      nextProps.store.data,\n                      props.scope,\n                      store,\n                      nextProps.syncSuperStore === true\n                    )\n              )\n            );\n          } else if (nextProps.data && (nextProps.data as any).__super) {\n            store.initData(extendObject(nextProps.data));\n          } else {\n            store.initData(createObject(nextProps.scope, nextProps.data));\n          }\n        } else if (\n          (shouldSync === true ||\n            !nextProps.store ||\n            nextProps.data !== nextProps.store.data) &&\n          nextProps.data &&\n          nextProps.data.__super\n        ) {\n          // 这个用法很少，当 data.__super 值发生变化时，更新 store.data\n          (!props.data ||\n            isObjectShallowModified(\n              nextProps.data.__super,\n              props.data.__super,\n              false\n            )) &&\n            // nextProps.data.__super !== props.data.__super) &&\n            store.initData(\n              createObject(nextProps.data.__super, {\n                ...nextProps.data,\n                ...store.data\n              }),\n\n              store.storeType === 'FormStore' &&\n                props.store?.storeType === 'CRUDStore'\n            );\n        } else if (\n          nextProps.scope &&\n          nextProps.data === nextProps.store!.data &&\n          (shouldSync === true || props.data !== nextProps.data)\n        ) {\n          store.initData(\n            createObject(nextProps.scope, {\n              // ...nextProps.data,\n              ...store.data\n            })\n          );\n        }\n      }\n\n      componentWillUnmount() {\n        const rootStore = this.context as IRendererStore;\n        const store = this.store;\n        rootStore.removeStore(store);\n\n        // @ts-ignore\n        delete this.store;\n      }\n\n      renderChild(\n        region: string,\n        node: SchemaNode,\n        subProps: {\n          data?: object;\n          [propName: string]: any;\n        } = {}\n      ) {\n        let {render} = this.props;\n\n        return render(region, node, {\n          data: this.store.data,\n          dataUpdatedAt: this.store.updatedAt,\n          ...subProps,\n          scope: this.store.data,\n          store: this.store\n        });\n      }\n\n      render() {\n        const {detectField, ...rest} = this.props;\n\n        let exprProps: any = {};\n        if (!detectField || detectField === 'data') {\n          exprProps = getExprProperties(rest, this.store.data, undefined, rest);\n\n          if (exprProps.hidden || exprProps.visible === false) {\n            return null;\n          }\n        }\n\n        return (\n          <Component\n            {\n              ...(rest as any) /* todo */\n            }\n            {...exprProps}\n            ref={this.refFn}\n            data={this.store.data}\n            dataUpdatedAt={this.store.updatedAt}\n            store={this.store}\n            scope={this.store.data}\n            render={this.renderChild}\n          />\n        );\n      }\n    }\n    hoistNonReactStatic(StoreFactory, Component);\n\n    return StoreFactory;\n  };\n}\n"
    ]
}